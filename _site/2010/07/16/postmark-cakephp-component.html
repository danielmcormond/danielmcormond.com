<!doctype html>
<html>
	<head>
		<!--
		 __               ___                __   __   __         __        __
		|  \  /\  |\ | | |__  |        |\/| /  ` /  \ |__)  |\/| /  \ |\ | |  \
		|__/ /~~\ | \| | |___ |___     |  | \__, \__/ |  \  |  | \__/ | \| |__/
		
		-->
		<meta charset="utf-8">
		<meta name="description" content="Daniel McOrmond">
		<meta name="author" content="Daniel McOrmond">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<title>Daniel McOrmond</title>
		<link rel="stylesheet" href="/css/style.css">
		<script src="js/libs/modernizr-2.0.6.min.js"></script>
		<script type="text/javascript" src="http://use.typekit.com/nop2ftb.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
	</head>
	<body>
		<div id="container">
			<header>
				<h1 id="title"><a href="/">Daniel McOrmond</a></h1>
			</header>
			<div id="main" role="main">
				<p>I recently discovered the excellent email delivery service <a href='http://postmarkapp.com/'>Postmark</a>. We had been running into some trouble sending email from one of our web apps. The SMTP server on our <a href='http://www.dreamhost.com/r.cgi?467109'>Dreamhost</a> hosting account has a limit of 100 messages per hour. Additionally, many of our messages were bouncing and we had poor visibility into our delivery statistics.</p>

<p>There are some existing <a href='http://developer.postmarkapp.com/#php-5'>PHP libraries for Postmark</a> available, but none that integrated elegantly with our <a href='http://cakephp.org/'>CakePHP</a> based application. So I took a few minutes and whipped up a simple Postmark CakePHP component which I&#8217;ve made <a href='http://github.com/danielmcormond/postmark-cakephp'>available on Github</a>.</p>

<h4 id='configuration'>Configuration</h4>

<p>Add the following keys to your configuration:</p>

<p><code>
Configure::write(&#39;Postmark.uri&#39;, &#39;http://api.postmarkapp.com/email&#39;);
Configure::write(&#39;Postmark.key&#39;, &#39;810de23c-5ffb-44d9-a424-7a4a5c0fba1a&#39;);
</code></p>

<p>If you want your connection to Postmark to be encrypted, simply change the uri to use https.</p>

<p>Make sure to modified the API key to match the credentials for your Postmark server rack instance.</p>

<h4 id='usage'>Usage</h4>

<p>This component extends the base CakePHP email component, and works virtually the same.</p>

<p>Place the postmark.php file in your app/controllers/components/ folder.</p>

<p>In your controller, make sure the component is available:</p>

<p><code>public $components = array(&#39;Postmark&#39;);</code></p>

<p>Then, simply send messages like this:</p>

<p><code>
$this-&gt;Postmark-&gt;delivery = &#39;postmark&#39;;
$this-&gt;Postmark-&gt;from = &#39;sender@domain.com&#39;;
$this-&gt;Postmark-&gt;to = &#39;recipient@domain.com&#39;;
$this-&gt;Postmark-&gt;subject = &#39;this is the subject&#39;;
$messageBody = &#39;this is the message body&#39;;
$this-&gt;Postmark-&gt;send($messageBody);
</code></p>

<p>You can also use the following optional attributes:</p>

<p><code>
$this-&gt;Postmark-&gt;cc = array(&#39;recipient@domain.com&#39;);
$this-&gt;Postmark-&gt;bcc = array(&#39;recipient@domain.com&#39;);
$this-&gt;Postmark-&gt;replyTo = &#39;sender@domain.com&#39;;
</code></p>

<p>The syntax of all parameters is the same as the <a href='http://book.cakephp.org/view/1283/Email'>default CakePHP email component</a>.</p>

<p>There is one additional attribute which can be used for setting the <a href='http://developer.postmarkapp.com/#message-format'>Postmark tag property</a>:</p>

<p><code>$this-&gt;Postmark-&gt;tag = &#39;contact&#39;;</code></p>

<h4 id='debugging'>Debugging</h4>

<p>You can see the response from Postmark in the return value when you send a message:</p>

<p><code>
$result = $this-&gt;Postmark-&gt;send($messageBody);
$this-&gt;log($result, &#39;debug&#39;);
</code></p>

<p>If there are any errors, they&#8217;ll be included in the response. See the <a href='http://developer.postmarkapp.com/#api-error-codes'>Postmark API documentation for error code detail</a>.</p>

<h4 id='conclusion'>Conclusion</h4>

<p>Hopefully others will find this useful. If you have any questions, problems, or suggestions, please let me know! Here&#8217;s a link to the code: <a href='http://github.com/danielmcormond/postmark-cakephp'>Postmark CakePHP Component on GitHub</a>.</p>

			</div>
			<footer>
				<ul>
					<li><a href="http://twitter.com/DanielMcOrmond">Twitter</a></li>
					<li><a href="http://github.com/DanielMcOrmond">GitHub</a></li>
				</ul>
			</footer>
		</div>
	</body>
</html>
